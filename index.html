<!doctype html>
<html>
	<head>
		<title>Socket.IO chat</title>
		<link rel="stylesheet" type="text/css" href="css/rebr.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
	</head>
	<body>
		<form action="">
			<input class="orangeBox" id="searchCommand" autocomplete="off" value="ag" />
			<input class="orangeBox" id="searchPrefix" autocomplete="off" value="-C 5" />
			<input class="orangeBox" id="searchQuery" autocomplete="off" value="run_query" />
			<input class="orangeBox" id="searchSuffix" autocomplete="off" value="O:/Hackathon 2018/reBreather" />
			<button class="orangeBox">Send</button>
			</br>
			<input class="orangeBox smallConfig" id="splitRegex" autocomplete="off" value="--" />
			<input class="orangeBox smallConfig" id="tokenRegex" autocomplete="off" value="--" />
		</form>
		<ul id="messages"></ul>
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
		<script>
			var lastResult;
			$(function () {
				var socket = io();
				$('form').submit(function (){
					var sep = /,\s*/g;
					var queryArgs = $('#searchPrefix').val().split(sep).concat($('#searchQuery').val(), $('#searchSuffix').val().split(sep));

					socket.emit('query request', {
						command: $('#searchCommand').val(),
						args: queryArgs
					});
					$('#searchQuery').val('');
					return false;
				});
				socket.on('query result', function(msg){
					lastResult = msg;
					msg.split($('#splitRegex').val()).forEach(function(element){
						console.log(element);
						$('#messages').append($('<li>').html('<pre><code>' + hljs.highlightAuto(element).value + '</code></pre>'));
					});
				});
				socket.on('query object', function(msg){
					$('#messages').append($('<li>').text(msg));
				});
			});
		</script>
	</body>
</html>